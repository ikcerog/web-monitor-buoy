name: Scheduled Web Monitor

# Defines the trigger for the action: run on a schedule and allow manual trigger
on:
  schedule:
    # Runs at 15 minutes past every 3rd hour (e.g., 03:15, 06:15, 09:15 UTC)
    - cron: '15 */3 * * *' 
  workflow_dispatch: 

jobs:
  monitor:
    runs-on: ubuntu-latest
    steps:
      # 1. Checkout the repository code
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          # This token is required to allow the action to push changes back
          token: ${{ secrets.GITHUB_TOKEN }}

      # 2. Set up Python environment
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' 

      # 3. Install required libraries
      - name: Install dependencies
        run: |
          pip install requests

      # 4. Run the Python monitoring script (creates url_hashes.json & monitoring_report.xml)
      - name: Run Monitor
        run: python monitor.py

      # 5. Commit and Push the updated files
      - name: Commit and Push Changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'ðŸ¤– Automated: Update monitoring report [skip ci]'
          # Specify the files that need to be committed
          file_pattern: url_hashes.json monitoring_report.xml
